# PARAM step_size, "Step size"
# PARAM fine_step_size, "Fine step size"
# 
# IF $step_size < $fine_step_size
#     MESSAGE "Fine step voltage must be smaller than step voltage", 1
# ENDIF



ODBGET /Equipment/HAMEG0/Variables/State[1], now_state_hameg_channel

IF $now_state_hameg_channel == 0
    ODBSET /Equipment/HAMEG0/Variables/Set State[1], 1
    WAIT 10
ENDIF


# Save init current read
ODBGET /Equipment/HAMEG0/Variables/Current[1], init_current

# Turn on chip i
ODBSET /Equipment/Mupix/Settings/BIASDACS/5/BiasBlock_On, 5
ODBSET /Equipment/Switching/Settings/MupixChipToConfigure, 5
ODBSET /Equipment/Switching/Settings/MupixConfig, 1

WAIT SECONDS, 6


# Read final current
ODBGET /Equipment/HAMEG0/Variables/Current[1], current

# Turn off chip
ODBSET /Equipment/Mupix/Settings/BIASDACS/5/BiasBlock_On, 0
ODBSET /Equipment/Switching/Settings/MupixChipToConfigure, 5
ODBSET /Equipment/Switching/Settings/MupixConfig, 1

WAIT SECONDS, 3

# Save current difference
SET diff, $current-$init_current
MESSAGE $diff, 1
ODBSET /Equipment/Mupix/QCTests/Ladder/LVPowerOn/Output/current_increase[2], $diff

#ODBSET /Equipment/Mupix/Settings/BIASDACS/5/BiasBlock_On, 0
#ODBSET /Equipment/Switching/Settings/MupixChipToConfigure, 5
#ODBSET /Equipment/Switching/Settings/MupixConfig, 1
#WAIT 3
#
#ODBSET /Equipment/Mupix/Settings/BIASDACS/4/BiasBlock_On, 0
#ODBSET /Equipment/Switching/Settings/MupixChipToConfigure, 4
#ODBSET /Equipment/Switching/Settings/MupixConfig, 1
#WAIT 3
#
#ODBSET /Equipment/Mupix/Settings/BIASDACS/3/BiasBlock_On, 0
#ODBSET /Equipment/Switching/Settings/MupixChipToConfigure, 3
#ODBSET /Equipment/Switching/Settings/MupixConfig, 1
#WAIT 3


