#!/bin/bash

PREFIX="@CMAKE_INSTALL_PREFIX@"
SOURCE="@PROJECT_SOURCE_DIR@"
BINDIR="${PREFIX}/bin"
BINDIRMIDAS="@MIDASSYS@/bin"
LIBDIR="${PREFIX}/lib"

PATH="${BINDIR}:${BINDIRMIDAS}:${PATH}"
if [[ "$OSTYPE" == "darwin"* ]]; then
    export DYLD_LIBRARY_PATH="${LIBDIR}${DYLD_LIBRARY_PATH:+:}${DYLD_LIBRARY_PATH}";
fi

export MIDASSYS=@MIDASSYS@
export MIDAS_EXPTAB="${SOURCE}/online/exptab"
export MIDAS_EXPT_NAME="Mu3e"
if [ ! -f "${MIDAS_EXPTAB}" ]; then
    echo "${MIDAS_EXPTAB} does not exist, creating default exptab with experiment name ${MIDAS_EXPT_NAME}"
    echo "#Exptname    Expt Directory             Username" >> ${MIDAS_EXPTAB}
    echo "${MIDAS_EXPT_NAME}    ${SOURCE}/online    ${USER}" >> ${MIDAS_EXPTAB}
fi

#Remove duplicates in $PATH
if [ -n "$PATH" ]; then
    old_PATH=$PATH:; PATH=
    while [ -n "$old_PATH" ]; do
        x=${old_PATH%%:*}         # the first remaining entry
        case $PATH: in
            *:"$x":*) ;;          # already there
            *) PATH=$PATH:$x;;    # not there yet
        esac
        old_PATH=${old_PATH#*:}
    done
    PATH=${PATH#:}
    unset old_PATH x
fi

# bash or zsh require a rehash to pick up new commands
if test -n "${BASH}" -o -n "${ZSH_VERSION}"; then
    hash -r
fi

# setup mu3edisplay path
ln -sf ~/analyzer/packages/mu3edisplay ~/online/online
ln -sf ~/analyzer/packages/mu3edisplay/config ~/online/online

# setup onlineAna path
ln -sf ~/online/modules/jsroot ~/online/online

#
# [SR] Personal git-xy alias to be used by all of us, please add one for yourself
#
alias git-sr='env GIT_AUTHOR_NAME="Stefan Ritt" GIT_AUTHOR_EMAIL="stefan.ritt@psi.ch" git'
alias git-mm='env GIT_AUTHOR_NAME="Martin Mueller" GIT_AUTHOR_EMAIL="mmarti04@students.uni-mainz.de" git'
alias git-fw='env GIT_AUTHOR_NAME="Frederik Wauters" GIT_AUTHOR_EMAIL="fwauters@uni-mainz.de" git'
alias git-nb='env GIT_AUTHOR_NAME="Niklaus Berger" GIT_AUTHOR_EMAIL="niberger@uni-mainz.de" git'
alias git-mk='env GIT_AUTHOR_NAME="Marius Koeppel" GIT_AUTHOR_EMAIL="koeppel.ma@googlemail.com" git'
