<!DOCTYPE html>
<html class="mcss">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="midas.css">
    <script src="controls.js"></script>
    <script src="midas.js"></script>
    <script src="mhttpd.js"></script>
    <title>Slow Control</title>

    <style>
        .mtable td { padding: 10px; }
    </style>

    <script>
        function read_file(){

            // // get the file field
            // var $field = $("myFile");
            // // create a new FileReader object
            // var reader = new FileReader();
            // // when the file has finished reading,
            // // store it's contents to a variable (async)
            // reader.onload = function( ev ) {
            //     var contents = JSON.parse( decodeURIComponent( ev.target.result ) );
            // };


            var x = document.getElementById("myFile");
            var txt = "";
            if ('files' in x) {
                if (x.files.length == 0) {
                    txt = "Select one or more files.";
                } else {
                    for (var i = 0; i < x.files.length; i++) {
                        txt += (i+1) + ". file";
                        var file = x.files[i];
                        if ('name' in file) {
                            txt += "name: " + file.name + " ";
                        }
                        if ('size' in file) {
                            txt += "size: " + file.size + " bytes ";
                        }
                    }
                }
            }
            else {
                if (x.value == "") {
                    txt += "Select one or more files.";
                } else {
                    txt += "The files property is not supported by your browser!";
                    txt  += "The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead.
                }
            }
            document.getElementById("display_file").innerHTML = txt;
        }

        function create_link_in_odb(){
            var paths = ["/custom/slow_control_files/file"];
            var types = [TID_STRING];
            var stringlengths = [128];
            ODBMCreate(paths, types, arraylengths);
        }

        function load() {
            var paths = [ "/custom/slow_control_files/file"];
            var data_odb=ODBMCopy(paths, mcopy_callback, "json");
        }
    </script>

</head>

<body class="mcss" onload="mhttpd_init('Example');">

<!-- header and side navigation will be filled in mhttpd_init -->
<div id="mheader"></div>
<div id="msidenav"></div>

<div id="mmain">
    <table class="mtable">
        <tr>
            <th colspan="2" class="mtableheader">Send Slow Control</th>
        </tr>

        <tr>
            <td colspan="2" style="text-align: center;">
                <p>
                    Please specify a file, or a set of files:<br>
                    <input type="file" id="myFile" multiple size="50" onchange="read_file()">
                </p>

                <textarea id="display_file" style="width:400px;height:150px;"></textarea>
            </td>
        </tr>


        <tr>
            <td colspan="2" style="text-align: center;">
                <button name="modbbutton" class="mbutton" onclick="create_link_in_odb()">Create file in odb
                </button>
                <button name="modbbutton" class="mbutton" onclick="load()">Load file
                </button>
            </td>
        </tr>
    </table>
</div>

</body>



</html>
