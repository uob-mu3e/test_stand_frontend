#!/bin/bash
# start_daq.sh

PREFIX=@CMAKE_INSTALL_PREFIX@
SOURCE=@PROJECT_SOURCE_DIR@
BINDIR=${PREFIX}/bin
LIBDIR=${PREFIX}/lib

source "${PREFIX}/set_env.sh"

cd "${SOURCE}/online"

odbedit -c clean

odbedit -c 'mkdir Custom'
odbedit -d Custom -c 'create STRING Path'
odbedit -c "set Custom/Path $SOURCE/mhttpd/custom"

#create custom pages for DAQ slow control
odbedit -d Custom -c 'create STRING SC'
odbedit -c 'set Custom/SC sc.html'
odbedit -d Custom -c 'create STRING SciFi-ASICs'
odbedit -c 'set Custom/SciFi-ASICs mutrigTdc.html'
#odbedit -d Custom -c 'create STRING MALIBU'
#odbedit -c 'set Custom/MALIBU TileGUI/MALIBUMonitor/Monitor.html'
odbedit -d Custom -c 'create STRING MuPix'
odbedit -c 'set Custom/MuPix MuPixTB.html'
#set Analysis
odbedit -d Custom -c 'create STRING TileAna '
odbedit -c 'set Custom/TileAna ana_mutrig/mutrig/tile_ana.html'

#set mhttpd to run http
odbedit -c 'set "Experiment/http redirect to https" "n"'

xterm -hold -e "mhttpd" &
sleep 0.2
xterm -hold -e "mserver" &
sleep 0.2
# Start front-ends before the logger!
xterm -hold -e "crfe" &
sleep 0.2
xterm -hold -e "msysmon-nvidia" &
sleep 0.2
# xterm -hold -e "switch_fe" &
# sleep 0.2
xterm -hold -e "mlogger" &
#xterm -hold -e "switch_fe" &
#xterm -hold -e "malibu_fe" &

sleep 2

odbedit -c 'set Logger/History/FILE/Active y'
odbedit -c 'set Logger/History/MIDAS/Active n'

odbedit -c 'set Programs/Logger/Required y'
odbedit -c 'set "Programs/Logger/Start command" "mlogger -D"'

odbedit -c 'set Programs/mserver/Required y'
odbedit -c 'set "Programs/mserver/Start command" "mserver -D"'

odbedit -c 'set Programs/msysmon/Required y'
odbedit -c 'set "Programs/msysmon/Start command" "msysymon-nvidia -D"'
